## Part 1. Инструмент **ipcalc**
**== Задание ==**
Проверили версию Ubuntu, выполнив команду cat /etc/issue:

![версия Ubuntu](/src/Screenshots/Ubuntu.png)


##### Поднять виртуальную машину (далее -- ws1)

![Виртуальная машина ws1](/src/Screenshots/Виртуальная_машина_ws1.png)


#### 1.1. Сети и маски
##### Определить и записать в отчёт:
##### 1) Адрес сети *192.167.38.54/13*

![Сетевой_адрес](/src/Screenshots/Сетевой_адрес.png)


##### 2) Перевод маски *255.255.255.0* в префиксную и двоичную запись, */15* в обычную и двоичную, *11111111.11111111.11111111.11110000* в обычную и префиксную


255.255.255.0 в префиксную и двоичную:


![Преобразование_маски_2552552550](/src/Screenshots/Преобразование_маски_2552552550.png)


/15 в обычную и двоичную:


![Преобразование_маски_15](/src/Screenshots/Преобразование_маски_15.png)


11111111.11111111.11111111.11110000 в обычную и префиксную:


![Преобразование_маски_28](/src/Screenshots/Преобразование_маски_28.png)


##### 3) Минимальный и максимальный хост в сети *12.167.38.4* при масках: */8*, *11111111.11111111.00000000.00000000*, *255.255.254.0* и */4*
Минимальный и максимальный хост в сети 12.167.38.4 при маске /8:


![Мин_макс_8](/src/Screenshots/Мин_макс_8.png)


Минимальный и максимальный хост в сети 12.167.38.4 при маске /11111111.11111111.00000000.00000000:


![Мин_макс_16](/src/Screenshots/Мин_макс_16.png)


Минимальный и максимальный хост в сети 12.167.38.4 при маске /255.255.254.0:


![Мин_макс_23](/src/Screenshots/Мин_макс_23.png)


Минимальный и максимальный хост в сети 12.167.38.4 при маске /4:


![Мин_макс_4](/src/Screenshots/Мин_макс_4.png)


Минимальный и максимальный хост в сети 255.255.254.0 при маске /4:


![Мин_макс_23_4](/src/Screenshots/Мин_макс_23_4.png)


#### 1.2. localhost
##### Определить и записать в отчёт, можно ли обратиться к приложению, работающему на localhost, со следующими IP: *194.34.23.100*, *127.0.0.2*, *127.1.0.1*, *128.0.0.1*

Возможно получить доступ: 127.0.0.2; 127.1.0.1

![Проверка_локалхост_1](/src/Screenshots/Проверка_локалхост_1.png)


Невозможно получить доступ: 194.34.23.100; 128.0.0.1


![Проверка_локалхост_2](/src/Screenshots/Проверка_локалхост_2.png)



#### 1.3. Диапазоны и сегменты сетей
##### Определить и записать в отчёт:
##### 1) какие из перечисленных IP можно использовать в качестве публичного, а какие только в качестве частных: *10.0.0.45*, *134.43.0.2*, *192.168.4.2*, *172.20.250.4*, *172.0.2.1*, *192.172.0.1*, *172.68.0.2*, *172.16.255.255*, *10.10.10.10*, *192.169.168.1*

Частные:


![Частные_1](/src/Screenshots/Частные_1.png)


![Частные_2](/src/Screenshots/Частные_2.png)


![Частные_3](/src/Screenshots/Частные_3.png)


Публичные:


![Публичные_1](/src/Screenshots/Публичные_1.png)


![Публичные_2](/src/Screenshots/Публичные_2.png)


![Публичные_3](/src/Screenshots/Публичные_3.png)


##### 2) какие из перечисленных IP адресов шлюза возможны у сети *10.10.0.0/18*: *10.0.0.1*, *10.10.0.2*, *10.10.10.10*, *10.10.100.1*, *10.10.1.255*
Возможны: 10.10.0.2, 10.10.10.10, 10.10.1.255
Невозможны: 10.0.0.1, 10.10.100.1
## Part 2. Статическая маршрутизация между двумя машинами

**== Задание ==**

##### Поднять две виртуальные машины (далее -- ws1 и ws2)

##### С помощью команды `ip a` посмотреть существующие сетевые интерфейсы

![ip_a_ws1](/src/Screenshots/ip_a_ws1.png)


![ip_a_ws2](/src/Screenshots/ip_a_ws2.png)


##### Описать сетевой интерфейс, соответствующий внутренней сети, на обеих машинах и задать следующие адреса и маски: ws1 - *192.168.100.10*, маска */16*, ws2 - *172.24.116.8*, маска */12*
Cкрины с содержанием изменённого файла *etc/netplan/00-installer-config.yaml*:

Для ws1:


![netplan_ws1](/src/Screenshots/netplan_ws1.png)


Для ws2:


![netplan_ws2](/src/Screenshots/netplan_ws2.png)


##### Выполнить команду `netplan apply` для перезапуска сервиса сети
Скрин с вызовом и выводом использованной команды:

Для ws1:


![netplanapply_ws1](/src/Screenshots/netplanapply_ws1.png)


Для ws2:


![netplanapply_ws2](/src/Screenshots/netplanapply_ws2.png)


#### 2.1. Добавление статического маршрута вручную
##### Добавить статический маршрут от одной машины до другой и обратно при помощи команды вида `ip r add`
##### Пропинговать соединение между машинами

Команды и пинг для ws1:


![ping_ws1_ws2](/src/Screenshots/ping_ws1_ws2.png)


Команды и пинг для ws1:


![ping_ws2_ws1](/src/Screenshots/ping_ws2_ws1.png)


#### 2.2. Добавление статического маршрута с сохранением
##### Перезапустить машины
##### Добавить статический маршрут от одной машины до другой с помощью файла *etc/netplan/00-installer-config.yaml*


Cтатический маршрут от ws1 одной машины до ws2:


![Cтатический маршрут от ws1 одной машины до ws2](/src/Screenshots/netplan_save_ws1.png)


Cтатический маршрут от ws2 одной машины до ws1:


![Cтатический маршрут от ws2 одной машины до ws1](/src/Screenshots/netplan_save_ws2.png)


##### Пропинговали соединения от ws1 к ws2:


![Пропинговали соединения от ws1 к ws2](/src/Screenshots/ping_save_ws1_ws2.png)


##### Пропинговали соединения от ws2 к ws1:


![Пропинговали соединения от ws2 к ws1](/src/Screenshots/ping_save_ws2_ws1.png)


## Part 3. Утилита **iperf3**

**== Задание ==**

#### 3.1. Скорость соединения
##### 8Mbps→1MB/s
##### 100MB/s→819200Kbps
##### 1Gbps→1024Mbps

#### 3.2. Утилита **iperf3**
##### Измерить скорость соединения между ws1 и ws2

Запуск сервера ws1:


![Запустили iperf3 ws1](/src/Screenshots/iperf3_ws1.png)
Запуск сервера ws2:


![Запустили iperf3 ws2](/src/Screenshots/iperf3_ws2.png)


## Part 4. Сетевой экран

`-` После соединения машин, перед нами стоит следующая задача: контролировать информацию, проходящую по соединению. Для этого используются сетевые экраны.

**== Задание ==**

*В данном задании используются виртуальные машины ws1 и ws2 из Части 2*

#### 4.1. Утилита **iptables**
##### Создать файл */etc/firewall.sh*, имитирующий фаерволл, на ws1 и ws2:
Firewall сервера ws1:


![Firewall сервера ws1](/src/Screenshots/firewall_ws1.png)


Firewall сервера ws2:


![Firewall сервера ws2](/src/Screenshots/firewall_ws2.png)


Запущенный файл с помощью команд и пинг ws1:


![Ping firewall ws1](/src/Screenshots/ping_firewall_ws1.png)


Запущенный файл с помощью команд и пинг ws2:


![Ping firewall ws2](/src/Screenshots/ping_firewall_ws2.png)


`В первой стратегии разрешаем все, что не запрещено, а во второй запрещаем все, что не разрешено. Но при написании правил стоит учитывать, что запрещающие правила не перезаписываются разрешающими.`
## Part 4. Сетевой экран
#### 4.2. Утилита **nmap**
##### Командой **ping** найти машину, которая не "пингуется", после чего утилитой **nmap** показать, что хост машины запущен


Вывод команд ping и nmap:


![nmap_ws2](/src/Screenshots/nmap_ws2.png)


## Part 5. Статическая маршрутизация сети

#### 5.1. Настройка адресов машин
##### Настроить конфигурации машин в *etc/netplan/00-installer-config.yaml* согласно сети на рисунке.


etc/netplan/00-installer-config.yaml для ws11:


![netplan_yaml_ws11](/src/Screenshots/netplan_ws11.png)


etc/netplan/00-installer-config.yaml для ws21:


![netplan_yaml_ws21](/src/Screenshots/netplan_ws21.png)


etc/netplan/00-installer-config.yaml для ws22:


![netplan_yaml_ws22](/src/Screenshots/netplan_ws22.png)


etc/netplan/00-installer-config.yaml для r1:


![netplan_yaml_r1](/src/Screenshots/netplan_r1.png)


etc/netplan/00-installer-config.yaml для r2:

![netplan_yaml_r2](/src/Screenshots/netplan_r2.png)


##### Перезапустить сервис сети. Если ошибок нет, то командой `ip -4 a` проверить, что адрес машины задан верно. Также пропинговать ws22 с ws21. Аналогично пропинговать r1 с ws11.

Проверка адреса ws11:


![ip4a_ws11](/src/Screenshots/ip4a_ws11.png)


Проверка адреса ws21:


![ip4a_ws21](/src/Screenshots/ip4a_ws21.png)


Проверка адреса ws22:


![ip4a_ws22](/src/Screenshots/ip4a_ws22.png)


Проверка адреса r1:


![ip4a_r1](/src/Screenshots/ip4a_r1.png)


Проверка адреса r2:


![ip4a_r2](/src/Screenshots/ip4a_r2.png)


Пинг ws11 с r1:


![ping_ws11_r1](/src/Screenshots/ping_ws11_r1.png)


Пинг ws21 с ws22:


![ping_ws21_ws22](/src/Screenshots/ping_ws21_ws22.png)


#### 5.2. Включение переадресации IP-адресов.
##### Для включения переадресации IP, выполните команду на роутерах:
`sysctl -w net.ipv4.ip_forward=1`


Команда на роутере r1:


![net_ipv4_r1](/src/Screenshots/net_ipv4_r1.png)


Команда на роутере r2:


![net_ipv4_r2](/src/Screenshots/net_ipv4_r2.png)


##### Откройте файл */etc/sysctl.conf* и добавьте в него следующую строку:
`net.ipv4.ip_forward = 1`


Файл /etc/sysctl.conf на роутере r1:


![sysctl_r1](/src/Screenshots/sysctl_r1.png)


Файл /etc/sysctl.conf на роутере r2:


![sysctl_r2](/src/Screenshots/sysctl_r2.png)


#### 5.3. Установка маршрута по-умолчанию

##### Настроить маршрут по-умолчанию (шлюз) для рабочих станций. Для этого добавить gateway4 /[ip роутера/] в файле конфигураций

Настройка конфигурационного файла netplan с добавлением gateway4 на ws11:


![5.3.netplan_ws11](/src/Screenshots/5_3_netplan_ws11.png)


Настройка конфигурационного файла netplan с добавлением gateway4 на ws21:


![5.3.netplan_ws21](/src/Screenshots/5_3_netplan_ws21.png)


Настройка конфигурационного файла netplan с добавлением gateway4 на ws22:


![5.3.netplan_ws22](/src/Screenshots/5_3_netplan_ws22.png)


##### Вызвать `ip r` и показать, что добавился маршрут в таблицу маршрутизации


Вывод команды `ip r` после добавления шлюза на ws11:


![5.3.ipr_ws11](/src/Screenshots/5_3_ipr_ws11.png)


Вывод команды `ip r` после добавления шлюза на ws21:


![5.3.ipr_ws21](/src/Screenshots/5_3_ipr_ws21.png)


Вывод команды `ip r` после добавления шлюза на ws22:


![5.3.ipr_ws22](/src/Screenshots/5_3_ipr_ws22.png)


##### Пропинговать с ws11 роутер r2 и показать на r2, что пинг доходит. Для этого использовать команду:
`tcpdump -tn -i eth1`


Пинг ws11 с r2:


![5_3_ping_ws11_r2](/src/Screenshots/5_3_ping_ws11_r2.png)


Вывод команды `tcpdump -tn -i eth1` с r2:


![5_3_ping_ws11_r2](/src/Screenshots/5_3_tcpdump_r2_ws11.png)


#### 5.4. Добавление статических маршрутов
##### Добавить в роутеры r1 и r2 статические маршруты в файле конфигураций. Пример для r1 маршрута в сетку 10.20.0.0/26:

Настройка конфигурационного файла netplan с добавлением статических маршрутов на r1:


![5.4.netplan_r1](/src/Screenshots/5_4_netplan_r1.png)


Настройка конфигурационного файла netplan с добавлением статических маршрутов на r2:


![5.4.netplan_r2](/src/Screenshots/5_4_netplan_r2.png)


##### Вызвать `ip r` и показать таблицы с маршрутами на обоих роутерах. Пример таблицы на r1:


Вывод команды `ip r` c маршрутами на r1:


![5.4.ipr_r1](/src/Screenshots/5_4_ipr_r1.png)


Вывод команды `ip r` c маршрутами на r2:


![5.4.ipr_r2](/src/Screenshots/5_4_ipr_r2.png)

##### Запустить команды на ws11:

Вывод команды `ip r list` на ws11:


![5.4.iprlist_ws11](/src/Screenshots/5_4_iprlist_ws11.png)


`Для адреса 10.10.0.0/[порт сети] был выбран маршрут, отличный от 0.0.0.0/0, так как маршрут с более длинной маской предпочтительнее`

#### 5.5. Построение списка маршрутизаторов
Пример вывода утилиты **traceroute** после добавления шлюза:
```
1 10.10.0.1 0 ms 1 ms 0 ms
2 10.100.0.12 1 ms 0 ms 1 ms
3 10.20.0.10 12 ms 1 ms 3 ms
```
##### Запустить на r1 команду дампа:
`tcpdump -tnv -i eth0`
##### При помощи утилиты **traceroute** построить список маршрутизаторов на пути от ws11 до ws21

Вывод traceroute от ws11 до ws21:


![5.5.traceroute_ws11](/src/Screenshots/5_5_traceroute_ws11.png)


Вывод tcpdump на r1:


![5.5.tcpdump_ws11](/src/Screenshots/5_5_tcpdump_r1.png)


`Для определения промежуточных маршрутизаторов traceroute отправляет серию пакетов данных целевому узлу, при этом каждый раз увеличивая значение поля TTL до достижения цели.`

#### 5.6. Использование протокола **ICMP** при маршрутизации
##### Запустить на r1 перехват сетевого трафика, проходящего через eth0 с помощью команды:
`tcpdump -n -i eth0 icmp`
##### Пропинговать с ws11 несуществующий IP (например, *10.30.0.111*) с помощью команды:
`ping -c 1 10.30.0.111`


Пинг ws11 с 10.30.0.111:


![5_5_ping_ws11](/src/Screenshots/5_5_ping_ws11.png)


Перехват сетевого трафика с r1:


![5.5.tcpdump_ping_ws11](/src/Screenshots/5_5_tcpdump_ping_r1.png)


## Part 6. Динамическая настройка IP с помощью **DHCP**

**== Задание ==**

##### Для r2 настроить в файле */etc/dhcp/dhcpd.conf* конфигурацию службы **DHCP**:
Указали адрес маршрутизатора по-умолчанию, DNS-сервер и адрес внутренней сети на r2.


![6.dhcpd_r2](/src/Screenshots/6_dhcpd_r2.png)


В файле *resolv.conf* прописали `nameserver 8.8.8.8.`


![6.resolv_r2](/src/Screenshots/6_resolv_r2.png)


Перезагрузили службу **DHCP** командой `systemctl restart isc-dhcp-server` и проверили статус: 


![6.dhcpd_restart_status_r2](/src/Screenshots/6_dhcpd_restart_status_r2.png)


Машину ws21 перезагрузили при помощи `reboot` и через `ip a` показали, что она получила адрес. Также пропинговали ws22 с ws21.


![6.ipa_ping_ws21](/src/Screenshots/6_ipa_ping_ws21.png)


##### Указать MAC адрес у ws11, для этого в *etc/netplan/00-installer-config.yaml* надо добавить строки: `macaddress: 10:10:10:10:10:BA`, `dhcp4: true`


Изменённый файл *etc/netplan/00-installer-config.yaml* на ws11:


![6.netplan_ws11](/src/Screenshots/6_netplan_ws11.png)


##### Для r1 настроить аналогично r2, но сделать выдачу адресов с жесткой привязкой к MAC-адресу (ws11). Провести аналогичные тесты


Сделали выдачу адресов с жесткой привязкой к MAC-адресу (ws11) на r1:


![6.dhcpd_r1](/src/Screenshots/6_dhcpd_r1.png)


В файле *resolv.conf* прописали `nameserver 8.8.8.8.`


![6.resolv_r1](/src/Screenshots/6_resolv_r1.png)


Перезагрузили службу **DHCP** командой `systemctl restart isc-dhcp-server` и проверили статус: 


![6.dhcpd_restart_status_r1](/src/Screenshots/6_dhcpd_restart_status_r1.png)


Машину ws11 перезагрузили при помощи `reboot` и через `ip a` показали, что она получила адрес. Также пропинговали ws11 с r1:


![6.ipa_ping_ws11](/src/Screenshots/6_ipa_ping_ws11.png)


Запросили с ws21 обновление ip адреса:
Скрин ip до обновления с ws21:


![6.ipa_ws21_до](/src/Screenshots/6_ipa_ws21_до.png)


Скрин ip после обновления с ws21:


![6.ipa_ws21_после](/src/Screenshots/6_ipa_ws21_после.png)


`dhclient -r - для освобождения теĸущего адреса;
dhclient - запрос у DHCP-сервера нового адреса.`

## Part 7. **NAT**
**== Задание ==**

##### В файле */etc/apache2/ports.conf* на ws22 и r1 изменить строку `Listen 80` на `Listen 0.0.0.0:80`, то есть сделать сервер Apache2 общедоступным
##### Запустить веб-сервер Apache командой `service apache2 start` на ws22 и r1


Изменение ports.conf на ws22 и запуск веб-сервера Apache:


![7.apache2_ws22](/src/Screenshots/7_apache2_ws22.png)


Изменение ports.conf на r1 и запуск веб-сервера Apache:


![7.apache2_r1](/src/Screenshots/7_apache2_r1.png)


##### Добавить в фаервол, созданный по аналогии с фаерволом из Части 4, на r2 следующие правила:
##### 1) Удаление правил в таблице filter - `iptables -F`
##### 2) Удаление правил в таблице "NAT" - `iptables -F -t nat`
##### 3) Отбрасывать все маршрутизируемые пакеты - `iptables --policy FORWARD DROP`
##### Запускать файл также, как в Части 4


Изменение и запуск firewall.sh на r2:


![7.firewall_r2](/src/Screenshots/7_firewall_r2.png)


##### Проверить соединение между ws22 и r1 командой `ping`


Неудачный пинг с ws22 на r1:


![7.ping_ws22_r1_failed](/src/Screenshots/7_ping_ws22_r1_failed.png)


Неудачный пинг с r1 на ws22:


![7.ping_r1_ws22_failed](/src/Screenshots/7_ping_r1_ws22_failed.png)


##### Добавить в файл ещё одно правило:
##### 4) Разрешить маршрутизацию всех пакетов протокола **ICMP**
##### Запускать файл также, как в Части 4


Добавление разрешения и запуск firewall.sh на r2:


![7.firewall_accept_r2](/src/Screenshots/7_firewall_accept_r2.png)


##### Проверить соединение между ws22 и r1 командой `ping`


Удачный пинг с ws22 на r1:


![7.ping_ws22_r1_ok](/src/Screenshots/7_ping_ws22_r1_ok.png)


Удачный пинг с r1 на ws22:


![7.ping_r1_ws22_ok](/src/Screenshots/7_ping_r1_ws22_ok.png)


##### Добавить в файл ещё два правила:
##### 5) Включить **SNAT**, а именно маскирование всех локальных ip из локальной сети, находящейся за r2 (по обозначениям из Части 5 - сеть 10.20.0.0)
##### 6) Включить **DNAT** на 8080 порт машины r2 и добавить к веб-серверу Apache, запущенному на ws22, доступ извне сети
##### Запускать файл также, как в Части 4


Добавление SNAT & DNAT и запуск firewall.sh на r2:


![7.firewall_snat_dnat_r2](/src/Screenshots/7_firewall_snat_dnat_r2.png)


##### Проверить соединение по TCP для **SNAT**, для этого с ws22 подключиться к серверу Apache на r1 командой:


Соединение по TCP с ws22 на r1:


![7.telnet_ws22](/src/Screenshots/7_telnet_ws22.png)


##### Проверить соединение по TCP для **DNAT**, для этого с r1 подключиться к серверу Apache на ws22 командой `telnet` (обращаться по адресу r2 и порту 8080)


Соединение по TCP с r1 на ws22:


![7.telnet_r1](/src/Screenshots/7_telnet_r1.png)


## Part 8. Дополнительно. Знакомство с **SSH Tunnels**

**== Задание ==**
##### Запустить на r2 фаервол с правилами из Части 7


Запуск firewall.sh на r2:


![8.firewall_r2](/src/Screenshots/8_firewall_r2.png)


##### Запустить веб-сервер **Apache** на ws22 только на localhost (то есть в файле */etc/apache2/ports.conf* изменить строку `Listen 80` на `Listen localhost:80`)

Запуск и изменение **Apache** на ws22:


![8.localhost80_ws22](/src/Screenshots/8_localhost80_ws22.png)

##### Воспользоваться *Local TCP forwarding* с ws21 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws21


Получение доступа к серверу с ws21 до ws22:


![8.lws21_ssh_ws22](/src/Screenshots/8_ws21_ssh_ws22.png)


##### Воспользоваться *Remote TCP forwarding* c ws11 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws11


Получение доступа к серверу с ws11 до ws22:


![8.lws11_ssh7777_ws22](/src/Screenshots/8_ws11_ssh7777_ws22.png)


##### Для проверки, сработало ли подключение в обоих предыдущих пунктах, перейдите во второй терминал (например, клавишами Alt + F2) и выполните команду:
`telnet 127.0.0.1 [локальный порт]`


Проверка подключения с ws21 до ws22:


![8.telnet_ws21](/src/Screenshots/8_telnet_ws21.png)


Проверка подключения с ws11 до ws22:


![8.telnet_ws11](/src/Screenshots/8_telnet_ws11.png)

`Remote TCP forwarding - В OpenSSH переадресация локальных портов SSH задается с помощью -L параметра;
Remote TCP forwarding - В OpenSSH переадресация удаленных портов SSH задается с помощью -R параметра;
telnet необходим для проверки подключения.`